# 埋め込みSQL
埋め込みSQLは手続き型プログラミングに関係データベースを操作させるためのSQLを組み込む手法である. 

## 静的SQLと動的SQL
埋め込みSQLには静的SQLと動的SQLという概念がある. 静的SQLはあらかじめ決められたSQL文をプログラム中に埋め込んで実行する方式である. データベースの表から1行を取り出すことを非カーソル処理といい, その場合のselece文は次のようになる.
```sql
exec sql select 列名リスト into :ホスト変数名リスト
from 表名
[where 条件]
```
例えば, 社員表から社員コードが'100'である社員の社員名と年齢を取り出して変数name, ageに代入するクエリは次のようになる. ホスト変数はデータベースとプログラムのインターフェースとなる変数で, SQLの結果を格納し, 通常のプログラム変数としても扱えるためどちらかもアクセスできる.

```sql
exec sql select 社員名, 年齢 into :name, :age 
from 社員表
where 社員コード = '100'; 
```

一方で動的SQLはプログラム実行中でなければクエリが決まらないような場合に, 動的にクエリを生成して実行する方式のことを指す.

## カーソル処理とfetch
select into形式では, 1行のデータを取り出すことしかできない. カーソル処理を用いることで複数行からなる問い合わせ結果をあたかも1つのファイルであるかのようにとらえてfetch文を用いて1行ずつ取り出すことができる. カーソル処理の手順とそれに対応するクエリを次に示す.

1. select文に対してカーソルを宣言する.
2. カーソルを開いてselect文を実行する.
3. fetchを用いて結果を1行取り出す.
4. データの終端のとき, カーソルを閉じる(カーソル処理終了).
5. (取り出した値をもとに何らかの処理を行う)
6. 3に戻る.

```sql
/* カーソルの宣言 */
declare カーソル名 cursor for select文
```

```sql
/* カーソルを開く */
open カーソル名
```

```sql
/* 1行ずつ取り出す */
fetch カーソル名 into 結果受け取りのホスト変数
```

```sql
/* カーソルを閉じる */
close カーソル名
```
